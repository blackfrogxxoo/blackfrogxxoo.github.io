<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="最初的美好没有历史包袱，就没有压力，就是美好的。 假设项目启动了这样一个业务——造车：生产一辆小汽车(Car)，分别在不同的零件车间（车架（Sheel）、发动机（Engine）、车轮（Wheel））安装相应的零件，所有零件安装完成后回到提车车间就可以提车。  这样的需求开发起来很简单：  数据实体 123456789101112131415161718192021data class Car(">
<meta property="og:type" content="article">
<meta property="og:title" content="拒绝代码PUA，优雅地迭代业务代码">
<meta property="og:url" content="http://example.com/2023/09/04/first/index.html">
<meta property="og:site_name" content="blackfrog">
<meta property="og:description" content="最初的美好没有历史包袱，就没有压力，就是美好的。 假设项目启动了这样一个业务——造车：生产一辆小汽车(Car)，分别在不同的零件车间（车架（Sheel）、发动机（Engine）、车轮（Wheel））安装相应的零件，所有零件安装完成后回到提车车间就可以提车。  这样的需求开发起来很简单：  数据实体 123456789101112131415161718192021data class Car(">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c902c7bfa03c40d7b2efd8ee5cd4a9bd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=270&h=600&s=496136&e=gif&f=136&b=fcf7fc">
<meta property="og:image" content="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0051cf92f0c44acb8ade924b7d9b253~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=270&h=600&s=606740&e=gif&f=260&b=fbf7fc">
<meta property="article:published_time" content="2023-09-04T04:12:57.000Z">
<meta property="article:modified_time" content="2023-09-06T03:45:08.957Z">
<meta property="article:author" content="blackfrog">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="抽象">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c902c7bfa03c40d7b2efd8ee5cd4a9bd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=270&h=600&s=496136&e=gif&f=136&b=fcf7fc">


<link rel="canonical" href="http://example.com/2023/09/04/first/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/09/04/first/","path":"2023/09/04/first/","title":"拒绝代码PUA，优雅地迭代业务代码"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>拒绝代码PUA，优雅地迭代业务代码 | blackfrog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">blackfrog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">慎 敬 勤 恒</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%88%9D%E7%9A%84%E7%BE%8E%E5%A5%BD"><span class="nav-number">1.</span> <span class="nav-text">最初的美好</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E8%BF%AD%E4%BB%A3"><span class="nav-number">2.</span> <span class="nav-text">开始迭代</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E8%BF%AD%E4%BB%A3%E5%88%B0%E5%B4%A9%E6%BA%83"><span class="nav-number">3.</span> <span class="nav-text">从迭代到崩溃</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E9%9B%85%E5%9C%B0%E8%BF%AD%E4%BB%A3%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81%EF%BC%9F"><span class="nav-number">4.</span> <span class="nav-text">优雅地迭代业务代码？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Emo%E6%97%B6%E9%97%B4"><span class="nav-number">5.</span> <span class="nav-text">Emo时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E9%9B%85%E8%BD%AC%E8%BA%AB"><span class="nav-number">6.</span> <span class="nav-text">优雅转身</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">blackfrog</p>
  <div class="site-description" itemprop="description">blackfrog的个人博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/04/first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="blackfrog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="blackfrog">
      <meta itemprop="description" content="blackfrog的个人博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="拒绝代码PUA，优雅地迭代业务代码 | blackfrog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          拒绝代码PUA，优雅地迭代业务代码
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-04 12:12:57" itemprop="dateCreated datePublished" datetime="2023-09-04T12:12:57+08:00">2023-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 11:45:08" itemprop="dateModified" datetime="2023-09-06T11:45:08+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%87%8D%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">重构</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="最初的美好"><a href="#最初的美好" class="headerlink" title="最初的美好"></a>最初的美好</h2><p>没有历史包袱，就没有压力，就是美好的。</p>
<p>假设项目启动了这样一个业务——造车：生产一辆小汽车(<code>Car</code>)，分别在不同的零件车间（车架（<code>Sheel</code>）、发动机（<code>Engine</code>）、车轮（<code>Wheel</code>））安装相应的零件，所有零件安装完成后回到提车车间就可以提车。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c902c7bfa03c40d7b2efd8ee5cd4a9bd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=270&h=600&s=496136&e=gif&f=136&b=fcf7fc" alt="image"></p>
<p>这样的需求开发起来很简单：</p>
<ul>
<li><p>数据实体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">data class Car(</span><br><span class="line">    var shell: Shell? = null,</span><br><span class="line">    var engine: Engine? = null,</span><br><span class="line">    var wheel: Wheel? = null,</span><br><span class="line">) : Serializable &#123;</span><br><span class="line">    override fun toString(): String &#123;</span><br><span class="line">        return &quot;Car: Shell($&#123;shell&#125;), Engine($&#123;engine&#125;), Wheel($&#123;wheel&#125;)&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data class Shell(</span><br><span class="line">    ...</span><br><span class="line">) : Serializable</span><br><span class="line"></span><br><span class="line">data class Engine(</span><br><span class="line">    ...</span><br><span class="line">) : Serializable</span><br><span class="line"></span><br><span class="line">data class Wheel(</span><br><span class="line">    ...</span><br><span class="line">) : Serializable</span><br></pre></td></tr></table></figure>
</li>
<li><p>零件车间（以车架为例）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">class ShellFactoryActivity : AppCompatActivity() &#123;</span><br><span class="line">    private lateinit var btn: Button</span><br><span class="line">    private lateinit var back: Button</span><br><span class="line">    private lateinit var status: TextView</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_shell_factory)</span><br><span class="line">        val car = intent.getSerializableExtra(&quot;car&quot;) as Car</span><br><span class="line">        status = findViewById(R.id.status)</span><br><span class="line">        btn = findViewById(R.id.btn)</span><br><span class="line">        btn.setOnClickListener &#123;</span><br><span class="line">            car.shell = Shell(</span><br><span class="line">                id = 1,</span><br><span class="line">                name = &quot;比亚迪车架&quot;,</span><br><span class="line">                type = 1</span><br><span class="line">            )</span><br><span class="line">            status.text = car.toString()</span><br><span class="line">        &#125;</span><br><span class="line">        back = findViewById(R.id.back)</span><br><span class="line">        back.setOnClickListener &#123;</span><br><span class="line">            setResult(RESULT_OK, intent.apply &#123;</span><br><span class="line">                putExtra(&quot;car&quot;, car)</span><br><span class="line">            &#125;)</span><br><span class="line">            finish()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class EngineFactoryActivity : AppCompatActivity() &#123;</span><br><span class="line">    // 和安装车架流程一样</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WheelFactoryActivity : AppCompatActivity() &#123;</span><br><span class="line">    // 和安装车架流程一样</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>提车车间</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> car: Car? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        car = Car()</span><br><span class="line">        refreshStatus()</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.shell).setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> it = Intent(<span class="keyword">this</span>, ShellFactoryActivity::<span class="keyword">class</span>.java)</span><br><span class="line">            it.putExtra(<span class="string">&quot;car&quot;</span>, car)</span><br><span class="line">            startActivityForResult(it, REQUEST_SHELL)</span><br><span class="line">        &#125;</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.engine).setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> it = Intent(<span class="keyword">this</span>, EngineFactoryActivity::<span class="keyword">class</span>.java)</span><br><span class="line">            it.putExtra(<span class="string">&quot;car&quot;</span>, car)</span><br><span class="line">            startActivityForResult(it, REQUEST_ENGINE)</span><br><span class="line">        &#125;</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.wheel).setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> it = Intent(<span class="keyword">this</span>, WheelFactoryActivity::<span class="keyword">class</span>.java)</span><br><span class="line">            it.putExtra(<span class="string">&quot;car&quot;</span>, car)</span><br><span class="line">            startActivityForResult(it, REQUEST_WHEEL)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">        <span class="keyword">if</span> (resultCode != RESULT_OK) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">when</span> (requestCode) &#123;</span><br><span class="line">            REQUEST_SHELL -&gt; &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;安装车架完成&quot;</span>)</span><br><span class="line">                car = <span class="keyword">data</span>?.getSerializableExtra(<span class="string">&quot;car&quot;</span>) <span class="keyword">as</span> Car</span><br><span class="line">            &#125;</span><br><span class="line">            REQUEST_ENGINE -&gt; &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;安装发动机完成&quot;</span>)</span><br><span class="line">                car = <span class="keyword">data</span>?.getSerializableExtra(<span class="string">&quot;car&quot;</span>) <span class="keyword">as</span> Car</span><br><span class="line">            &#125;</span><br><span class="line">            REQUEST_WHEEL -&gt; &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;安装车轮完成&quot;</span>)</span><br><span class="line">                car = <span class="keyword">data</span>?.getSerializableExtra(<span class="string">&quot;car&quot;</span>) <span class="keyword">as</span> Car</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        refreshStatus()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">refreshStatus</span><span class="params">()</span></span> &#123;</span><br><span class="line">        findViewById&lt;TextView&gt;(R.id.status).text = car?.toString()</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.save).run &#123;</span><br><span class="line">            isEnabled = car?.shell != <span class="literal">null</span> &amp;&amp; car?.engine != <span class="literal">null</span> &amp;&amp; car?.wheel != <span class="literal">null</span></span><br><span class="line">            setOnClickListener &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, <span class="string">&quot;提车咯！&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> REQUEST_SHELL = <span class="number">1</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> REQUEST_ENGINE = <span class="number">2</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> REQUEST_WHEEL = <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>即使是初学者也能看出来，业务实现起来很简单，通过<code>Activity</code>的<code>startActivityForResult</code>就能跳转到相应的零件车间，安装好零件回到提车车间就完事了。</p>
<h2 id="开始迭代"><a href="#开始迭代" class="headerlink" title="开始迭代"></a>开始迭代</h2><p>往往业务的第一个版本就是这么简单，感觉也没什么好重构的。</p>
<p>但是业务难免会进行迭代。比如业务迭代到1.1版本：客户想要给汽车装上行车电脑，而安装行车电脑不需要跳转到另一个车间，而是在提车车间操作，但是需要很长的时间。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0051cf92f0c44acb8ade924b7d9b253~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=270&h=600&s=606740&e=gif&f=260&b=fbf7fc" alt="image"></p>
<p>看起来也简单，新增一个<code>Computer</code>实体类和<code>ComputerFactoryHelper</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">object ComputerFactoryHelper &#123;</span><br><span class="line">    fun provideComputer(block: Computer.() -&gt; Unit) &#123;</span><br><span class="line">        Thread.sleep(5_000)</span><br><span class="line">        block(Computer())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data class Computer(</span><br><span class="line">    val id: Int = 1,</span><br><span class="line">    val name: String = &quot;行车电脑&quot;,</span><br><span class="line">    val cpu: String = &quot;麒麟90000&quot;</span><br><span class="line">) : Serializable &#123;</span><br><span class="line">    override fun toString(): String &#123;</span><br><span class="line">        return &quot;$name-$cpu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再在提车车间新增按钮和逻辑代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">findViewById&lt;Button&gt;(R.id.computer).setOnClickListener &#123;</span><br><span class="line">    object : Thread() &#123;</span><br><span class="line">        override fun run() &#123;</span><br><span class="line">            ComputerFactoryHelper.provideComputer &#123;</span><br><span class="line">                car?.computer = this</span><br><span class="line">                runOnUiThread &#123; refreshStatus() &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目前看起来也没啥难的，那是因为我们模拟的业务场景足够简单，但是相信很多实际项目的屎山代码，就是通过这样的业务迭代，一点一点地堆积而成的。</p>
<h2 id="从迭代到崩溃"><a href="#从迭代到崩溃" class="headerlink" title="从迭代到崩溃"></a>从迭代到崩溃</h2><p>咱们来采访一下最近被一个小小的业务迭代需求搞崩溃的Android开发——小王。</p>
<blockquote>
<p>记者：小王你好，听说最近你Emo了，甚至多次萌生了就地辞职的念头？</p>
<p>小王：最近AI不是很火吗，产品给我提了一个需求，在上传音乐时可以选择在后端生成一个AI视频，然后一起上传。</p>
<p>记者：哦？这不是一个小需求吗？</p>
<p>小王：但是我打开目前上传业务的代码就傻了啊！就说Activity吧，有：BasePublishActivity，BasePublishFinallyActivity，SinglePublishMusicActivity，MultiPublishMusicActivity，PublishFinallyActivity，PublishCutMusicFinallyActivity， Publish(好多好多)FinallyActivity… 当然，这只是冰山一角。再说上传流程。如果只上传一首音乐，需要先调一个接口<code>/sts</code>拿到一个Oss Token，再调用第三方的Oss库上传文件，拿到一个url，然后再把这个url和其他的信息（标题、标签等）组成一个HashMap，再调用一个接口<code>/save</code>提交到后端，相当于调3个接口… 如果要批量上传N个音乐，就要调3 * N个接口，如果还要给每个音乐配M个图片，就要调3 * N+3 * N * M个接口… 如果上传一个音乐配一个本地视频，就要调3 * 2 * N个接口，并且，上传视频流程还不一样的是，需要在调用<code>/save</code>接口之后再调用第三方Oss上传视频文件…再说数据类。上面提到上传过程中需要添加图片、视频、活动类型啥的，代码里封装了一个EditInfo类足足有30个属性！，由于是Java代码并且实现了<code>Parcelable</code>接口，光一个Data类就有400多行！你以为这就完了？EditInfo需要在上传时转成PublishInfo类，PublishInfo还可以转成PublishDraft，PublishDraft可以保存到数据库中，从数据库中可以读取PublishDraft然后转成EditInfo再重新编辑…</p>
<p>记者：（感觉小王精神状态有点问题，于是掐掉了直播画面）</p>
</blockquote>
<p>相信小王的这种情况，很多业务开发同学都经历过吧。回头再看一下前面的造车业务，其实和小王的上传业务一样，就是一开始很简单，迭代个7、8个版本就开始陷入一种困境：即使迭代需求再小，开发起来都很困难。</p>
<h2 id="优雅地迭代业务代码？"><a href="#优雅地迭代业务代码？" class="headerlink" title="优雅地迭代业务代码？"></a>优雅地迭代业务代码？</h2><p>假如咱们想要优雅地迭代业务代码，应该怎么做呢？</p>
<p>小王遇到的这座屎山，咱们现在就不要去碰了，先就从前面提到的造车业务开始吧。</p>
<p>很多同学会想到<strong>重构</strong>，俺也一样。接下来，我就要讨论一下如何<strong>优雅</strong>而<strong>安全</strong>地重构既有业务代码。</p>
<blockquote>
<p>先抛出一个观点：<strong>对于程序员来说，想要保持“优雅”，最重要的品质就是抽象。</strong></p>
</blockquote>
<p>❓ 这时可能有同学就要反驳我了：过早的抽象没有必要。</p>
<p>❗ 别急，我现在要说的抽象，并不是<strong>代码层面的抽象</strong>，而是对<strong>业务的抽象</strong>，乃至对<strong>技术思维的抽象</strong>。</p>
<p>什么是<strong>代码层面的抽象</strong>？比如刚刚的<code>Shell/Engine/WheelFactoryActivity</code>，其实是可以抽象为<code>BaseFactoryActivity</code>，然后通过实现其中的零件类型就行了。但我不会建议你这么做，为啥？看看小王刚才的疯言疯语就明白了。各个<code>XxxFactoryActivity</code>看着差不多，但在实际项目中很可能会开枝散叶，各自迭代出不同的业务细节。到那时，项目里就是各种<code>BaseXxxActivity</code>，<code>XxxV1Activity</code>，<code>XxxV2Activity</code>…</p>
<p>那什么又是<strong>业务的抽象</strong>？直接上代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface CarFactory &#123;</span><br><span class="line">    val factory: suspend Car.() -&gt; Car</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>造车业务，无论在哪个环节，都是在<code>Car</code>上装配零件（或者任何出其不意的操作），然后产生一个新的<code>Car</code>；另外，这个环节无论是跳转到零件车间安装零件，还是在提车车间里安装行车电脑，都是耗时操作，所以需要加<code>suspend</code>关键词。</p>
<p>❓ 这时可能有同学说：害！你这和<code>BaseFactoryActivity</code>有啥区别，不就是把抽象类换成接口了吗？</p>
<p>❗ 别急，我并没有要让<code>XxxFactoryActivity</code>去继承<code>CarFactory</code>啊，想想小王吧，这个<code>XxxFactoryActivity</code>就相当于他的同事在两年前写的代码，小王肯定打死都不会想去修改这里面的代码的。</p>
<p><code>Computer</code>是新业务，我们只改它。首先我们根据这个接口把<code>ComputerFactoryHelper</code>改一下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> ComputerFactoryHelper : CarFactory &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">provideComputer</span><span class="params">(block: <span class="type">Computer</span>.() -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">        delay(<span class="number">5_000</span>)</span><br><span class="line">        block(Computer())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> factory: <span class="keyword">suspend</span> Car.() -&gt; Car = &#123;</span><br><span class="line">        provideComputer &#123;</span><br><span class="line">            computer = <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么，在提车车间就可以这样改：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> computerFactory: CarFactory = ComputerFactoryHelper</span><br><span class="line">findViewById&lt;Button&gt;(R.id.computer).setOnClickListener &#123;</span><br><span class="line">    lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">        computerFactory.factory.invoke(car)</span><br><span class="line">        refreshStatus()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>❓ 那么<code>XxxFactoryActivity</code>相关的流程又应该怎么重构呢？</p>
<h2 id="Emo时间"><a href="#Emo时间" class="headerlink" title="Emo时间"></a>Emo时间</h2><p>我先反问一下大家，为啥咱们Android程序员总是盯着<code>Activity</code>不放呢？</p>
<p>我再反问一下大家，为啥咱们Android程序员总是盯着<code>Activity</code>不放呢？</p>
<p>我再再反问一下大家，为啥咱们Android程序员总是盯着<code>Activity</code>不放呢？</p>
<p>甚至，很多人即使学了<code>Compose</code>和<code>Flutter</code>，仍然对<code>Activity</code>心心念念。</p>
<blockquote>
<p>当你在一千个日日夜夜里，重复地写着<code>XxxActivity</code>，写<code>onCreate/onResume/onDestroy</code>，写<code>startActivityForResult/onActivityResult</code>时，当你每次想要换工作，打开面经背诵<code>Activity</code>的启动模式，生命周期，<code>AMS</code>原理时，可曾对<code>Activity</code>有过厌倦，可曾思考过编程的意义？</p>
<p>你也曾努力查阅<code>Activity</code>的源码，学习<code>MVP</code>&#x2F;<code>MVVM</code>&#x2F;<code>MVI</code>架构，试图让你的<code>Activity</code>保持清洁，但无论你怎么努力，却始终活在<code>Activity</code>的阴影之下。</p>
<p>你有没有想过，咱们正在被<code>Activity</code> <strong>PUA</strong>？</p>
</blockquote>
<p>说实话，作为一名INFP，本人不是很适合做程序员。相比技术栈的丰富和技术原理的深入，我更看重的是写代码的感受。如果写代码都能被PUA，那我还怎么愉快的写代码？</p>
<p>当我Emo了很久之后，我意识到了，我一直在被代码PUA，不光是同事的代码，也有自己的代码，甚至有Android框架，以及外国大佬不断推出的各种新技术新框架。</p>
<blockquote>
<p>对对对！你们都没有问题，是我太菜了555555555</p>
</blockquote>
<h2 id="优雅转身"><a href="#优雅转身" class="headerlink" title="优雅转身"></a>优雅转身</h2><p>Emo过后，还是得回到残酷的职场啊！但是我们要优雅地转身回来！</p>
<p>❓ 刚才不是说要处理<code>XxxFactoryActivity</code>相关业务吗？</p>
<p>❗ 这时我就要提到另外一种抽象：<strong>技术思维的抽象</strong>！</p>
<p>Activity？F*ck off！</p>
<p><code>Activity</code>的跳转返回啥的，也无非就是一次耗时操作嘛，咱们也应该将它抽象为<code>CarFactory</code>，就是这个东东:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface CarFactory &#123;</span><br><span class="line">    val factory: suspend Car.() -&gt; Car</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于这个信念，我从记忆中想到这么一个东东：<code>ActivityResultLauncher</code>。</p>
<p>说实话，我以前都没用过这玩意儿，但是我这时好像抓到了救命稻草。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/C_biubiubiu/article/details/123296728">随便搜了个教程并谢谢他</a>，参考这篇博客，我们可以把<code>startActivityForResult</code>和<code>onActivityResult</code>这套流程，封装成一次异步调用。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">BaseActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> startActivityForResultLauncher: StartActivityForResultLauncher</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        startActivityForResultLauncher = StartActivityForResultLauncher(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startActivityForResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        intent: <span class="type">Intent</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        callback: (<span class="type">resultCode</span>: <span class="type">Int</span>, <span class="type">data</span>: <span class="type">Intent</span>?) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> &#123;</span><br><span class="line">        startActivityForResultLauncher.launch(intent) &#123;</span><br><span class="line">            callback.invoke(it.resultCode, it.<span class="keyword">data</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让<code>MainActivity</code>继承<code>BaseActivity</code>，就可以绕过<code>Activity</code>了，后面的事情就简单了。只要咱们了解过协程，就能轻易想到异步转同步这一普通操作：<code>suspendCoroutine</code>。</p>
<p>于是，我们就可以在不修改<code>XxxFactoryActivity</code>的情况下，写出基于<code>CarFactory</code>的代码了。还是以车架车间为例：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ShellFactoryHelper</span>(<span class="keyword">private</span> <span class="keyword">val</span> activity: BaseActivity) : CarFactory &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> factory: <span class="keyword">suspend</span> Car.() -&gt; Car = &#123;</span><br><span class="line">        suspendCoroutine &#123; continuation -&gt;</span><br><span class="line">            <span class="keyword">val</span> it = Intent(activity, ShellFactoryActivity::<span class="keyword">class</span>.java)</span><br><span class="line">            it.putExtra(<span class="string">&quot;car&quot;</span>, <span class="keyword">this</span>)</span><br><span class="line">            activity.startActivityForResult(it) &#123; resultCode, <span class="keyword">data</span> -&gt;</span><br><span class="line">                (<span class="keyword">data</span>?.getSerializableExtra(<span class="string">&quot;car&quot;</span>) <span class="keyword">as</span>? Car)?.let &#123;</span><br><span class="line">                    Log.i(TAG, <span class="string">&quot;安装车壳完成&quot;</span>)</span><br><span class="line">                    shell = it.shell</span><br><span class="line">                    continuation.resumeWith(Result.success(<span class="keyword">this</span>))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在提车车间，和<code>Computer</code>业务同样的使用方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> shellFactory: CarFactory = ShellFactoryHelper(<span class="keyword">this</span>)</span><br><span class="line">findViewById&lt;Button&gt;(R.id.shell).setOnClickListener &#123;</span><br><span class="line">    lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">        shellFactory.factory.invoke(car)</span><br><span class="line">        refreshStatus()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终，在我们的提车车间，依赖的就是一些<code>CarFactory</code>，所有的业务操作都是抽象的。到达这个阶段，相信大家都有了自己的一些想法了（比如维护一个<code>carFactoryList</code>，用<code>Hilt</code>管理<code>CarFactory</code>依赖，泛型封装等），想要继续怎么重构&#x2F;维护，就全看自己的实际情况了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">class MainActivity : BaseActivity() &#123;</span><br><span class="line">    private var car: Car = Car()</span><br><span class="line">    private var computerFactory: CarFactory = ComputerFactoryHelper</span><br><span class="line">    private var engineFactory: CarFactory = EngineFactoryHelper(this)</span><br><span class="line">    private var shellFactory: CarFactory = ShellFactoryHelper(this)</span><br><span class="line">    private var wheelFactory: CarFactory = WheelFactoryHelper(this)</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        refreshStatus()</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.shell).setOnClickListener &#123;</span><br><span class="line">            lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">                shellFactory.factory.invoke(car)</span><br><span class="line">                refreshStatus()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.engine).setOnClickListener &#123;</span><br><span class="line">            lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">                engineFactory.factory.invoke(car)</span><br><span class="line">                refreshStatus()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.wheel).setOnClickListener &#123;</span><br><span class="line">            lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">                wheelFactory.factory.invoke(car)</span><br><span class="line">                refreshStatus()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.computer).setOnClickListener &#123;</span><br><span class="line">            lifecycleScope.launchWhenResumed &#123;</span><br><span class="line">                Toast.makeText(this@MainActivity, &quot;稍等一会儿&quot;, Toast.LENGTH_LONG).show()</span><br><span class="line">                computerFactory.factory.invoke(car)</span><br><span class="line">                Toast.makeText(this@MainActivity, &quot;装好了！&quot;, Toast.LENGTH_LONG).show()</span><br><span class="line">                refreshStatus()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun refreshStatus() &#123;</span><br><span class="line">        findViewById&lt;TextView&gt;(R.id.status).text = car.toString()</span><br><span class="line">        findViewById&lt;Button&gt;(R.id.save).run &#123;</span><br><span class="line">            isEnabled = car.shell != null &amp;&amp; car.engine != null &amp;&amp; car.wheel != null &amp;&amp; car.computer != null</span><br><span class="line">            setOnClickListener &#123;</span><br><span class="line">                Toast.makeText(this@MainActivity, &quot;提车咯！&quot;, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>抽象是程序员保持优雅的最重要能力。</li>
<li>抽象不应局限在代码层面，而是要上升到业务，乃至技术思维上。</li>
<li>有意识地对代码PUA说：No！</li>
<li>学习新技术时，不应只学会调用，也不应迷失在技术原理上，更重要的是花哨的技术和朴实的编程思想之间的化学反应。</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/%E6%8A%BD%E8%B1%A1/" rel="tag"># 抽象</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/05/26/hello-world/" rel="prev" title="Hello World">
                  <i class="fa fa-angle-left"></i> Hello World
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">blackfrog</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
